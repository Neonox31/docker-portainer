version: '2'
networks:
  weberhome_lan:
    external: true
services:
  portainer:
    image: portainer/portainer 
    container_name: portainer
    restart: always
    networks:
      - weberhome_lan
    ports:
      - "9000:9000"
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - /srv/docker/portainer:/data
    labels:
      - "traefik.backend=portainer"
      - "traefik.port=9000" 
      - "traefik.frontend.rule=Host:portainer.weberhome.lan"
  portainer-backup:
    image: tecnativa/duplicity:latest
    container_name: portainer-backup
    restart: always
    hostname: portainer-backup
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /srv/docker/portainer:/mnt/backup/src
      - /media/ops/backups/docker/portainer:/backup
    environment:
        # Duplicity options
        DST: file:///backup